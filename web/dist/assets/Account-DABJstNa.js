import{d as q,u as x,a as B,q as v,c as F,e as S,t as f,g as e,f as l,w as s,N as w,i as U,B as g,j as b,r as A,p as I,bs as _}from"./index-DQgClpag.js";import{u as L,N as i}from"./use-message-DfHQKw6A.js";import{N as h}from"./Form-CpuxP8S5.js";import{N as u}from"./FormItem-8Lqb3O-i.js";import{N as z}from"./Select-Dy_GmTdc.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-BT2YCJ3w.js";import"./Tag-B2_cy-hE.js";import"./Checkmark-BOYRWfKy.js";const V={class:"page-container"},j={class:"page-title"},D=q({__name:"Account",setup(E){const{t:a,locale:N}=x(),c=L(),p=B(),m=A(!1),n=v({username:p.username||"",preferred_locale:p.preferredLocale||"zh-CN"}),o=v({old:"",new:"",confirm:""}),y=[{label:"简体中文",value:"zh-CN"},{label:"English",value:"en"},{label:"繁體中文",value:"zh-TW"},{label:"日本語",value:"ja"},{label:"Русский",value:"ru"},{label:"Deutsch",value:"de"},{label:"Français",value:"fr"},{label:"한국어",value:"ko"}],C=I(()=>({old:{required:!0,message:a("validation.required"),trigger:"blur"},new:{required:!0,message:a("validation.required"),trigger:"blur"},confirm:[{required:!0,message:a("validation.required"),trigger:"blur"},{validator:()=>o.new===o.confirm,message:a("account.passwordMismatch"),trigger:"blur"}]}));async function k(){try{await _.updateLocale(n.preferred_locale),N.value=n.preferred_locale,p.setLocale(n.preferred_locale),c.success(a("common.success"))}catch(d){c.error(d.message||a("common.operationFailed"))}}async function P(){var d,r;if(o.new!==o.confirm){c.error(a("account.passwordMismatch"));return}m.value=!0;try{await _.changePassword(o.old,o.new),c.success(a("common.success")),o.old="",o.new="",o.confirm=""}catch(t){c.error(((r=(d=t.response)==null?void 0:d.data)==null?void 0:r.message)||"Change failed")}finally{m.value=!1}}return(d,r)=>(U(),F("div",V,[S("h1",j,f(e(a)("nav.account")),1),l(e(w),{title:e(a)("account.profile")},{default:s(()=>[l(e(h),{model:n,"label-placement":"top"},{default:s(()=>[l(e(u),{label:e(a)("auth.username")},{default:s(()=>[l(e(i),{value:n.username,"onUpdate:value":r[0]||(r[0]=t=>n.username=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),l(e(u),{label:e(a)("account.preferredLocale")},{default:s(()=>[l(e(z),{value:n.preferred_locale,"onUpdate:value":r[1]||(r[1]=t=>n.preferred_locale=t),options:y},null,8,["value"])]),_:1},8,["label"]),l(e(u),null,{default:s(()=>[l(e(g),{type:"primary",onClick:k},{default:s(()=>[b(f(e(a)("common.save")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]),l(e(w),{title:e(a)("account.changePassword"),style:{"margin-top":"16px"}},{default:s(()=>[l(e(h),{ref:"pwdFormRef",model:o,rules:C.value,"label-placement":"top"},{default:s(()=>[l(e(u),{label:e(a)("account.currentPassword"),path:"old"},{default:s(()=>[l(e(i),{value:o.old,"onUpdate:value":r[2]||(r[2]=t=>o.old=t),type:"password","show-password-on":"click"},null,8,["value"])]),_:1},8,["label"]),l(e(u),{label:e(a)("account.newPassword"),path:"new"},{default:s(()=>[l(e(i),{value:o.new,"onUpdate:value":r[3]||(r[3]=t=>o.new=t),type:"password","show-password-on":"click"},null,8,["value"])]),_:1},8,["label"]),l(e(u),{label:e(a)("account.confirmNewPassword"),path:"confirm"},{default:s(()=>[l(e(i),{value:o.confirm,"onUpdate:value":r[4]||(r[4]=t=>o.confirm=t),type:"password","show-password-on":"click"},null,8,["value"])]),_:1},8,["label"]),l(e(u),null,{default:s(()=>[l(e(g),{type:"primary",onClick:P,loading:m.value},{default:s(()=>[b(f(e(a)("account.changePassword")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]))}}),X=M(D,[["__scopeId","data-v-8197b465"]]);export{X as default};
