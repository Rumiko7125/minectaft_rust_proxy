import{a7 as de,I as ce,s as Y,a8 as ue,x as K,a9 as ve,y as J,d as ne,O as fe,C as u,K as me,aa as pe,E as he,U as Q,G as re,ab as ge,R as be,p as I,r as i,o as le,ac as ye,ad as ke,ae as we,W as _e,af as xe,u as ze,c as Z,e as c,t as B,g as s,f as h,w as O,ag as Oe,a3 as V,i as G,j,B as L,m as Te,l as Re,ah as Se,ai as Be}from"./index-DQgClpag.js";import{u as Ce}from"./useTimezone-tDSj6fKI.js";import{N as Pe,a as ee}from"./Tabs-c5IO-Gt9.js";import{N as te,a as ae,b as oe}from"./DataTable-BmjeHeaD.js";import{t as Le,N as je}from"./Tag-B2_cy-hE.js";import{u as Ee,N as se}from"./use-message-DfHQKw6A.js";import{N as Ne}from"./FormItem-8Lqb3O-i.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Add-C00RkFDM.js";import"./Popover-BT2YCJ3w.js";import"./Dropdown-BYzVsjoG.js";import"./get-slot-Bk_rJcZu.js";import"./Select-Dy_GmTdc.js";import"./Checkmark-BOYRWfKy.js";const Me=de&&"loading"in document.createElement("img");function He(o={}){var t;const{root:g=null}=o;return{hash:`${o.rootMargin||"0px 0px 0px 0px"}-${Array.isArray(o.threshold)?o.threshold.join(","):(t=o.threshold)!==null&&t!==void 0?t:"0"}`,options:Object.assign(Object.assign({},o),{root:(typeof g=="string"?document.querySelector(g):g)||document.documentElement})}}const D=new WeakMap,q=new WeakMap,X=new WeakMap,Ae=(o,t,g)=>{if(!o)return()=>{};const v=He(t),{root:d}=v.options;let f;const b=D.get(d);b?f=b:(f=new Map,D.set(d,f));let T,l;f.has(v.hash)?(l=f.get(v.hash),l[1].has(o)||(T=l[0],l[1].add(o),T.observe(o))):(T=new IntersectionObserver(_=>{_.forEach(y=>{if(y.isIntersecting){const k=q.get(y.target),C=X.get(y.target);k&&k(),C&&(C.value=!0)}})},v.options),T.observe(o),l=[T,new Set([o])],f.set(v.hash,l));let m=!1;const x=()=>{m||(q.delete(o),X.delete(o),m=!0,l[1].has(o)&&(l[0].unobserve(o),l[1].delete(o)),l[1].size<=0&&f.delete(v.hash),f.size||D.delete(d))};return q.set(o,x),X.set(o,g),x},Ie=ce("n-avatar-group"),Ue=Y("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[ue(K("&","--n-merged-color: var(--n-color-modal);")),ve(K("&","--n-merged-color: var(--n-color-popover);")),K("img",`
 width: 100%;
 height: 100%;
 `),J("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),Y("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),J("text","line-height: 1.25")]),$e=Object.assign(Object.assign({},re.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),We=ne({name:"Avatar",props:$e,slots:Object,setup(o){const{mergedClsPrefixRef:t,inlineThemeDisabled:g}=he(o),v=i(!1);let d=null;const f=i(null),b=i(null),T=()=>{const{value:a}=f;if(a&&(d===null||d!==a.innerHTML)){d=a.innerHTML;const{value:n}=b;if(n){const{offsetWidth:w,offsetHeight:z}=n,{offsetWidth:R,offsetHeight:F}=a,M=.9,A=Math.min(w/R*M,z/F*M,1);a.style.transform=`translateX(-50%) translateY(-50%) scale(${A})`}}},l=Q(Ie,null),m=I(()=>{const{size:a}=o;if(a)return a;const{size:n}=l||{};return n||"medium"}),x=re("Avatar","-avatar",Ue,ge,o,t),_=Q(Le,null),y=I(()=>{if(l)return!0;const{round:a,circle:n}=o;return a!==void 0||n!==void 0?a||n:_?_.roundRef.value:!1}),k=I(()=>l?!0:o.bordered||!1),C=I(()=>{const a=m.value,n=y.value,w=k.value,{color:z}=o,{self:{borderRadius:R,fontSize:F,color:M,border:A,colorModal:U,colorPopover:$},common:{cubicBezierEaseInOut:W}}=x.value;let P;return typeof a=="number"?P=`${a}px`:P=x.value.self[_e("height",a)],{"--n-font-size":F,"--n-border":w?A:"none","--n-border-radius":n?"50%":R,"--n-color":z||M,"--n-color-modal":z||U,"--n-color-popover":z||$,"--n-bezier":W,"--n-merged-size":`var(--n-avatar-size-override, ${P})`}}),S=g?be("avatar",I(()=>{const a=m.value,n=y.value,w=k.value,{color:z}=o;let R="";return a&&(typeof a=="number"?R+=`a${a}`:R+=a[0]),n&&(R+="b"),w&&(R+="c"),z&&(R+=xe(z)),R}),C,o):void 0,E=i(!o.lazy);le(()=>{if(o.lazy&&o.intersectionObserverOptions){let a;const n=ye(()=>{a==null||a(),a=void 0,o.lazy&&(a=Ae(b.value,o.intersectionObserverOptions,E))});ke(()=>{n(),a==null||a()})}}),we(()=>{var a;return o.src||((a=o.imgProps)===null||a===void 0?void 0:a.src)},()=>{v.value=!1});const N=i(!o.lazy);return{textRef:f,selfRef:b,mergedRoundRef:y,mergedClsPrefix:t,fitTextTransform:T,cssVars:g?void 0:C,themeClass:S==null?void 0:S.themeClass,onRender:S==null?void 0:S.onRender,hasLoadError:v,shouldStartLoading:E,loaded:N,mergedOnError:a=>{if(!E.value)return;v.value=!0;const{onError:n,imgProps:{onError:w}={}}=o;n==null||n(a),w==null||w(a)},mergedOnLoad:a=>{const{onLoad:n,imgProps:{onLoad:w}={}}=o;n==null||n(a),w==null||w(a),N.value=!0}}},render(){var o,t;const{$slots:g,src:v,mergedClsPrefix:d,lazy:f,onRender:b,loaded:T,hasLoadError:l,imgProps:m={}}=this;b==null||b();let x;const _=!T&&!l&&(this.renderPlaceholder?this.renderPlaceholder():(t=(o=this.$slots).placeholder)===null||t===void 0?void 0:t.call(o));return this.hasLoadError?x=this.renderFallback?this.renderFallback():fe(g.fallback,()=>[u("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):x=me(g.default,y=>{if(y)return u(pe,{onResize:this.fitTextTransform},{default:()=>u("span",{ref:"textRef",class:`${d}-avatar__text`},y)});if(v||m.src){const k=this.src||m.src;return u("img",Object.assign(Object.assign({},m),{loading:Me&&!this.intersectionObserverOptions&&f?"lazy":"eager",src:f&&this.intersectionObserverOptions?this.shouldStartLoading?k:void 0:k,"data-image-src":k,onLoad:this.mergedOnLoad,onError:this.mergedOnError,style:[m.style||"",{objectFit:this.objectFit},_?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),u("span",{ref:"selfRef",class:[`${d}-avatar`,this.themeClass],style:this.cssVars},x,f&&_)}}),Ke={class:"page-container"},Ve={class:"page-header"},Ge={class:"page-title"},De={class:"tab-toolbar"},qe={class:"player-count-badge"},Xe={key:0,class:"empty-state"},Ye={class:"empty-text"},Je={class:"pagination"},Qe={class:"tab-toolbar"},Ze={style:{display:"flex",gap:"8px","align-items":"center"}},et={style:{display:"flex",gap:"8px"}},tt={class:"pagination"},at={style:{display:"flex","justify-content":"flex-end",gap:"8px","margin-top":"8px"}},ot=ne({__name:"Players",setup(o){const{t}=ze(),{formatRelativeTime:g}=Ce(),v=Ee(),d=i(!1),f=i("online"),b=i([]),T=i([]),l=i(""),m=i(!1),x=i(""),_=i(""),y=i("kick"),k=i(""),C=i(1),S=i(20),E=i(0),N=i(1),a=i(20),n=i(0);function w(e){e==="online"?P():H()}function z(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(2)+" GB"}function R(e){return e?`https://api.mineatar.io/face/${e.replace(/-/g,"")}?scale=6`:""}function F(e){return e?e.substring(0,8)+"...":"-"}function M(e){x.value=t("players.kickTitle"),y.value="kick",k.value=e.username,_.value="",m.value=!0}function A(e){x.value=t("players.banTitle"),y.value="ban",k.value=e.username,_.value="",m.value=!0}async function U(){try{y.value==="kick"?(await V.kick(k.value,_.value||void 0),v.success(t("players.kickSuccess",{name:k.value}))):(await Se.addBlacklist(k.value,_.value||void 0),v.success(t("players.addBlacklistSuccess")),P()),m.value=!1}catch(e){v.error(e.message||t("common.operationFailed"))}}const $=[{title:"",key:"avatar",width:46,render:e=>u(We,{src:R(e.uuid),round:!0,size:"small",fallbackSrc:"https://crafatar.com/avatars/8667ba71-b85a-4004-af54-28e122c77270?size=32"})},{title:()=>t("table.username"),key:"username",width:140},{title:()=>t("table.uuid"),key:"uuid",width:110,render:e=>u(oe,{trigger:"hover"},{default:()=>e.uuid||"-",trigger:()=>u("span",{class:"uuid-short"},F(e.uuid))})},{title:()=>t("table.backend"),key:"backend_name",render:e=>u(je,{type:"default",size:"small"},{default:()=>e.backend_name||"-"})},{title:()=>t("table.version"),key:"version",width:110},{title:()=>t("table.loginTime"),key:"login_time",width:100,render:e=>g(e.login_time*1e3)},{title:()=>t("table.upload"),key:"upload_bytes",width:90,render:e=>u("span",{class:"traffic-up"},z(e.upload_bytes))},{title:()=>t("table.download"),key:"download_bytes",width:90,render:e=>u("span",{class:"traffic-down"},z(e.download_bytes))},{title:()=>t("table.action"),key:"action",width:160,render:e=>u("div",{style:"display:flex;gap:6px"},[u(L,{size:"small",type:"warning",onClick:()=>M(e)},{default:()=>t("players.kick")}),u(L,{size:"small",type:"error",onClick:()=>A(e)},{default:()=>t("players.addBlacklist")})])}],W=[{title:()=>t("table.username"),key:"username",width:140},{title:()=>t("table.uuid"),key:"uuid",width:110,render:e=>u(oe,{trigger:"hover"},{default:()=>e.uuid||"-",trigger:()=>u("span",{class:"uuid-short"},F(e.uuid))})},{title:()=>t("table.backend"),key:"backend_addr"},{title:()=>t("table.version"),key:"version",width:110},{title:()=>t("table.loginTime"),key:"login_at",width:100,render:e=>g(e.login_at)},{title:()=>t("table.logoutTime"),key:"logout_at",width:100,render:e=>e.logout_at?g(e.logout_at):u("span",{class:"text-muted"},"-")},{title:()=>t("table.upload"),key:"upload_bytes",width:90,render:e=>u("span",{class:"traffic-up"},z(e.upload_bytes||0))},{title:()=>t("table.download"),key:"download_bytes",width:90,render:e=>u("span",{class:"traffic-down"},z(e.download_bytes||0))}];async function P(){d.value=!0;try{const e=await V.getOnline({limit:S.value,offset:(C.value-1)*S.value});b.value=e.players||[],E.value=e.total||0}catch(e){console.error(e)}finally{d.value=!1}}async function H(){d.value=!0;try{const e=await V.getHistory({search:l.value||void 0,limit:a.value,offset:(N.value-1)*a.value});T.value=e.sessions||[],n.value=e.total||0}catch(e){console.error(e)}finally{d.value=!1}}async function ie(){try{const e=await Be.exportSessions({search:l.value||void 0}),r=new Blob([e.csv],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a");p.href=URL.createObjectURL(r),p.download="session_history.csv",p.click(),v.success(t("common.success"))}catch(e){v.error(e.message||t("common.operationFailed"))}}return le(async()=>{await P(),await H()}),(e,r)=>(G(),Z("div",Ke,[c("div",Ve,[c("div",null,[c("h1",Ge,B(s(t)("players.title")),1)])]),h(s(Pe),{value:f.value,"onUpdate:value":[r[3]||(r[3]=p=>f.value=p),w],type:"line"},{default:O(()=>[h(s(ee),{name:"online",tab:s(t)("players.tabOnline")},{default:O(()=>[c("div",De,[c("div",qe,[r[7]||(r[7]=c("span",{class:"dot online-dot"},null,-1)),j(" "+B(b.value.length)+" "+B(s(t)("dashboard.onlinePlayers")),1)]),h(s(L),{size:"small",onClick:P,loading:d.value},{icon:O(()=>[...r[8]||(r[8]=[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[c("polyline",{points:"23 4 23 10 17 10"}),c("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])]),default:O(()=>[j(" "+B(s(t)("common.refresh")),1)]),_:1},8,["loading"])]),!d.value&&b.value.length===0?(G(),Z("div",Xe,[r[9]||(r[9]=c("div",{class:"empty-icon"},"ðŸŽ®",-1)),c("div",Ye,B(s(t)("players.noOnline")),1)])):(G(),Te(s(te),{key:1,columns:$,data:b.value,loading:d.value,bordered:!1,size:"small"},null,8,["data","loading"])),c("div",Je,[h(s(ae),{page:C.value,"onUpdate:page":[r[0]||(r[0]=p=>C.value=p),P],"page-count":Math.ceil(E.value/S.value),"page-size":S.value},null,8,["page","page-count","page-size"])])]),_:1},8,["tab"]),h(s(ee),{name:"history",tab:s(t)("players.tabHistory")},{default:O(()=>[c("div",Qe,[c("div",Ze,[h(s(se),{value:l.value,"onUpdate:value":r[1]||(r[1]=p=>l.value=p),placeholder:s(t)("common.search"),clearable:"",style:{width:"220px"},onKeyup:Re(H,["enter"])},null,8,["value","placeholder"]),h(s(L),{onClick:H,size:"small"},{default:O(()=>[j(B(s(t)("common.search")),1)]),_:1})]),c("div",et,[h(s(L),{size:"small",onClick:ie},{default:O(()=>[j(B(s(t)("common.export")),1)]),_:1}),h(s(L),{size:"small",onClick:H,loading:d.value},{icon:O(()=>[...r[10]||(r[10]=[c("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[c("polyline",{points:"23 4 23 10 17 10"}),c("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])]),default:O(()=>[j(" "+B(s(t)("common.refresh")),1)]),_:1},8,["loading"])])]),h(s(te),{columns:W,data:T.value,loading:d.value,bordered:!1,size:"small"},null,8,["data","loading"]),c("div",tt,[h(s(ae),{page:N.value,"onUpdate:page":[r[2]||(r[2]=p=>N.value=p),H],"page-count":Math.ceil(n.value/a.value),"page-size":a.value},null,8,["page","page-count","page-size"])])]),_:1},8,["tab"])]),_:1},8,["value"]),h(s(Oe),{show:m.value,"onUpdate:show":r[6]||(r[6]=p=>m.value=p),preset:"card",title:x.value,style:{width:"420px"}},{default:O(()=>[h(s(Ne),{label:s(t)("table.reason")},{default:O(()=>[h(s(se),{value:_.value,"onUpdate:value":r[4]||(r[4]=p=>_.value=p),type:"textarea",placeholder:s(t)("players.reasonPlaceholder"),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"]),c("div",at,[h(s(L),{onClick:r[5]||(r[5]=p=>m.value=!1)},{default:O(()=>[j(B(s(t)("common.cancel")),1)]),_:1}),h(s(L),{type:y.value==="kick"?"warning":"error",onClick:U},{default:O(()=>[j(B(s(t)("common.confirm")),1)]),_:1},8,["type"])])]),_:1},8,["show","title"])]))}}),bt=Fe(ot,[["__scopeId","data-v-3106c4c3"]]);export{bt as default};
