import{d as T,u as V,S as k,a as I,o as K,b as f,c as M,e as n,f as r,w as u,g as e,N as U,h as A,i as N,j as x,t as v,k as D,l as h,m as E,n as F,B as O,p as P,r as g,q as R}from"./index-DQgClpag.js";import{u as j,N as w}from"./use-message-DfHQKw6A.js";import{N as z}from"./Dropdown-BYzVsjoG.js";import{N as G}from"./Form-CpuxP8S5.js";import{N as _}from"./FormItem-8Lqb3O-i.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-BT2YCJ3w.js";const J={class:"login-page"},Q={class:"login-lang"},W={class:"login-lang-btn"},X=T({__name:"Login",setup(Y){const y=A(),{t:o,locale:m}=V(),S=k.map(t=>({label:t.label,key:t.code})),L=P(()=>{var t;return((t=k.find(s=>s.code===m.value))==null?void 0:t.label)??m.value});function q(t){m.value=t,localStorage.setItem("proxy_locale",t)}const d=j(),B=I(),p=g(!1);K(async()=>{try{(await f.getStatus()).needs_setup&&y.replace("/setup")}catch{}});const c=g(!1),b=g(""),a=R({username:"",password:"",totp:""}),C={username:{required:!0,message:o("validation.required")},password:{required:!0,message:o("validation.required")}};async function i(){var t,s;if(!a.username||!a.password){d.error(o("validation.required"));return}p.value=!0;try{if(c.value){if(!a.totp){d.error(o("validation.required")),p.value=!1;return}const l=await f.totpVerify(a.username,b.value,a.totp);B.login(a.username,l.access_token),y.push("/dashboard")}else{const l=await f.login(a.username,a.password);l.status==="need_bind_2fa"?d.info(o("auth.bindTitle")):l.status==="need_totp"&&(c.value=!0,b.value=l.session_token)}}catch(l){d.error(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||o("auth.loginFailed"))}finally{p.value=!1}}return(t,s)=>(N(),M("div",J,[n("div",Q,[r(e(z),{options:e(S),onSelect:q,placement:"bottom-end","show-arrow":!1},{default:u(()=>[n("button",W,[s[3]||(s[3]=n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[n("circle",{cx:"12",cy:"12",r:"10"}),n("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),n("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})],-1)),x(" "+v(L.value),1)])]),_:1},8,["options"])]),r(e(U),{class:"login-card"},{default:u(()=>[n("h1",null,v(e(o)("auth.title")),1),r(e(G),{ref:"formRef",model:a,rules:C,onSubmit:D(i,["prevent"])},{default:u(()=>[r(e(_),{path:"username",label:e(o)("auth.username")},{default:u(()=>[r(e(w),{value:a.username,"onUpdate:value":s[0]||(s[0]=l=>a.username=l),onKeyup:h(i,["enter"])},null,8,["value"])]),_:1},8,["label"]),r(e(_),{path:"password",label:e(o)("auth.password")},{default:u(()=>[r(e(w),{value:a.password,"onUpdate:value":s[1]||(s[1]=l=>a.password=l),type:"password","show-password-on":"click",onKeyup:h(i,["enter"])},null,8,["value"])]),_:1},8,["label"]),c.value?(N(),E(e(_),{key:0,path:"totp",label:e(o)("auth.totpTitle")},{default:u(()=>[r(e(w),{value:a.totp,"onUpdate:value":s[2]||(s[2]=l=>a.totp=l),placeholder:e(o)("auth.totpPlaceholder"),onKeyup:h(i,["enter"])},null,8,["value","placeholder"])]),_:1},8,["label"])):F("",!0),r(e(O),{type:"primary",block:"",loading:p.value,onClick:i},{default:u(()=>[x(v(c.value?e(o)("auth.totpVerify"):e(o)("auth.login")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]))}}),le=H(X,[["__scopeId","data-v-21ae490c"]]);export{le as default};
