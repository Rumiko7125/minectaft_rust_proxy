import{d as ae,u as ne,o as ce,c as I,e,t as i,g as o,f as c,w as u,B as g,j as v,n as W,P as re,_ as de,Y as ue,bi as ve,ag as fe,r as d,q as _e,p as ge,ak as U,bj as pe,a6 as me,bk as $,a0 as he,i as D,$ as we}from"./index-DQgClpag.js";import{u as be,N as F}from"./use-message-DfHQKw6A.js";import{N as T}from"./InputNumber-B9FQEIAe.js";import{N as A}from"./Switch-DBlpryrk.js";import{N as q}from"./Select-Dy_GmTdc.js";import{N as ye}from"./FormItem-8Lqb3O-i.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-BT2YCJ3w.js";import"./Add-C00RkFDM.js";import"./Tag-B2_cy-hE.js";import"./Checkmark-BOYRWfKy.js";const xe={class:"page-container"},Ce={class:"page-header"},Ie={class:"page-title"},De={class:"page-subtitle"},Ne={style:{display:"flex",gap:"8px"}},Ue={class:"config-grid"},Fe={class:"config-section"},Le={class:"section-title"},Me={class:"config-card"},Se={class:"config-row"},Ee={class:"config-label"},Re={class:"config-control"},Te={class:"config-row"},Ae={class:"config-label"},ze={class:"config-control"},He={class:"config-row"},Pe={class:"config-label"},je={class:"config-control"},Be={class:"config-hint"},Oe={class:"config-section"},Ve={class:"section-title"},We={class:"config-card"},$e={class:"config-row"},qe={class:"config-label"},Ke={class:"config-control"},Ze={class:"config-row"},Ye={class:"config-label"},Ge={class:"config-control"},Je={class:"config-section"},Qe={class:"section-title"},Xe={class:"config-card"},eo={class:"config-row"},oo={class:"config-label"},to={class:"config-control"},so={class:"config-row"},lo={class:"config-label"},io={class:"config-control"},ao={class:"config-hint"},no={class:"config-row"},co={class:"config-label"},ro={class:"config-control"},uo={class:"config-section"},vo={class:"section-title"},fo={class:"config-card"},_o={class:"config-row"},go={class:"config-label"},po={class:"config-control"},mo={class:"config-row"},ho={class:"config-label"},wo={class:"config-control"},bo={class:"config-row"},yo={class:"config-label"},ko={class:"config-control"},xo={class:"config-section full-width"},Co={class:"config-card info-card"},Io={class:"info-content"},Do={class:"info-title"},No={class:"info-desc"},Uo={class:"cli-zone"},Fo={class:"cli-title"},Lo={class:"cli-desc"},Mo={class:"terminal-output"},So={key:0,class:"terminal-welcome"},Eo={class:"terminal-cmd"},Ro={class:"terminal-input-row"},To=["placeholder","disabled"],Ao={class:"migration-zone"},zo={class:"migration-title"},Ho={class:"migration-desc"},Po={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},jo={class:"danger-zone"},Bo={class:"danger-title"},Oo={class:"danger-desc"},Vo={class:"restart-warning"},Wo={style:{display:"flex","justify-content":"flex-end",gap:"8px"}},$o=ae({__name:"Config",setup(qo){const{t}=ne(),f=be(),L=d(!1),M=d(!1),b=d(!1),y=d(!1),k=d(""),z=d(null),_=d(""),x=d(!1),C=d([]),p=d([]),m=d(-1),H=d(null),P=d(null),K=d(null),n=_e({local_port:25565,allow_input:!0,trusted_domain:"",web_api_enable:!0,web_api_port:8080,enable_2fa:!1,two_factor_session_hours:24,two_factor_issuer:"MinecraftProxy",log_dir:"",show_log_level:3,save_log_level:2}),j=ge(()=>[{label:t("backend.logLevel0"),value:0},{label:t("backend.logLevel1"),value:1},{label:t("backend.logLevel2"),value:2},{label:t("backend.logLevel3"),value:3},{label:t("backend.logLevel4"),value:4}]);async function B(){try{const a=await U.get();Object.assign(n,a)}catch(a){console.error(a)}}async function Z(){L.value=!0;try{await U.update(n),f.success(t("common.saveSuccess"))}catch(a){f.error(a.message||t("common.saveFailed"))}finally{L.value=!1}}async function Y(){try{await U.reload(),f.success(t("config.reloadSuccess")),await B()}catch(a){f.error(a.message||t("common.operationFailed"))}}async function G(){if(!k.value){f.error(t("auth.totpPlaceholder"));return}M.value=!0;try{await U.restart(k.value),f.success(t("config.restartSuccess")),y.value=!1,k.value=""}catch(a){f.error(a.message||t("common.operationFailed"))}finally{M.value=!1}}const O={help:[],list:["players","whitelist","blacklist"],kick:[],ban:[],pardon:[],whitelist:["on","off","add","remove"],backend:["list","info","add","remove","enable","disable","default","maintenance"],"2fa":["list","remove"],config:["list","set","reload"],modlog:[]},h=d([]),N=d(0);let w=!1;function J(){const s=_.value.split(" ");let r,l;if(s.length<=1){const E=s[0]||"";r=Object.keys(O).filter(R=>R.startsWith(E)),l=""}else{const E=s[0],R=s[s.length-1];r=(O[E]||[]).filter(ie=>ie.startsWith(R)),l=s.slice(0,-1).join(" ")+" "}if(r.length===0)return;w?N.value=(N.value+1)%h.value.length:(h.value=r,N.value=0);const S=h.value[N.value];_.value=l+S+(h.value.length===1?" ":""),w=!0}function Q(a){a.key==="Tab"?(a.preventDefault(),J()):a.key==="Enter"?(a.preventDefault(),w=!1,h.value=[],V()):a.key==="ArrowUp"?(a.preventDefault(),w=!1,h.value=[],X()):a.key==="ArrowDown"?(a.preventDefault(),w=!1,h.value=[],ee()):(w=!1,h.value=[])}async function V(){var s,r;const a=_.value.trim();if(!(!a||x.value)){_.value="",x.value=!0,p.value[0]!==a&&(p.value.unshift(a),p.value.length>100&&p.value.pop()),m.value=-1;try{const l=await pe.execute(a);C.value.push({command:a,output:l.output,isError:!1})}catch(l){C.value.push({command:a,output:l.message||"Error",isError:!0})}finally{x.value=!1,await me(),(s=H.value)==null||s.scrollIntoView({behavior:"smooth"}),(r=P.value)==null||r.focus()}}}function X(){p.value.length!==0&&(m.value=Math.min(m.value+1,p.value.length-1),_.value=p.value[m.value])}function ee(){if(m.value<=0){m.value=-1,_.value="";return}m.value--,_.value=p.value[m.value]}function oe(){C.value=[]}async function te(){b.value=!0;try{const a=await $.exportData(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=`proxy_migration_${s}.zip`,r.click(),f.success(t("common.success"))}catch(a){f.error(a.message||t("common.operationFailed"))}finally{b.value=!1}}function se(){var a;(a=z.value)==null||a.click()}async function le(a){var r;const s=(r=a.target.files)==null?void 0:r[0];if(s){a.target.value="",b.value=!0;try{await $.importData(s),f.success(t("config.migrationImportSuccess"))}catch(l){f.error(l.message||t("common.operationFailed"))}finally{b.value=!1}}}return ce(B),(a,s)=>{const r=he("router-link");return D(),I("div",xe,[e("div",Ce,[e("div",null,[e("h1",Ie,i(o(t)("nav.config")),1),e("p",De,i(o(t)("config.subtitle")),1)]),e("div",Ne,[c(o(g),{onClick:Y},{default:u(()=>[v(i(o(t)("config.reload")),1)]),_:1}),c(o(g),{type:"primary",loading:L.value,onClick:Z},{default:u(()=>[v(i(o(t)("config.saveAll")),1)]),_:1},8,["loading"])])]),e("div",Ue,[e("div",Fe,[e("div",Le,"ðŸŒ "+i(o(t)("config.groupNetwork")),1),e("div",Me,[e("div",Se,[e("div",Ee,i(o(t)("config.proxyPort")),1),e("div",Re,[c(o(T),{value:n.local_port,"onUpdate:value":s[0]||(s[0]=l=>n.local_port=l),min:1,max:65535,style:{width:"140px"}},null,8,["value"])])]),e("div",Te,[e("div",Ae,i(o(t)("config.trustedDomain")),1),e("div",ze,[c(o(F),{value:n.trusted_domain,"onUpdate:value":s[1]||(s[1]=l=>n.trusted_domain=l),placeholder:o(t)("config.trustedDomainHint"),style:{width:"240px"}},null,8,["value","placeholder"])])]),e("div",He,[e("div",Pe,i(o(t)("config.allowInput")),1),e("div",je,[c(o(A),{value:n.allow_input,"onUpdate:value":s[2]||(s[2]=l=>n.allow_input=l)},null,8,["value"])]),e("div",Be,i(o(t)("config.allowInputHint")),1)])])]),e("div",Oe,[e("div",Ve,"ðŸ”Œ "+i(o(t)("config.groupWebApi")),1),e("div",We,[e("div",$e,[e("div",qe,i(o(t)("config.webApiEnable")),1),e("div",Ke,[c(o(A),{value:n.web_api_enable,"onUpdate:value":s[3]||(s[3]=l=>n.web_api_enable=l)},null,8,["value"])])]),e("div",Ze,[e("div",Ye,i(o(t)("config.webApiPort")),1),e("div",Ge,[c(o(T),{value:n.web_api_port,"onUpdate:value":s[4]||(s[4]=l=>n.web_api_port=l),min:1,max:65535,style:{width:"140px"}},null,8,["value"])])])])]),e("div",Je,[e("div",Qe,"ðŸ” "+i(o(t)("config.groupTwoFactor")),1),e("div",Xe,[e("div",eo,[e("div",oo,i(o(t)("config.twoFactorEnable")),1),e("div",to,[c(o(A),{value:n.enable_2fa,"onUpdate:value":s[5]||(s[5]=l=>n.enable_2fa=l)},null,8,["value"])])]),e("div",so,[e("div",lo,i(o(t)("config.twoFactorSessionHours")),1),e("div",io,[c(o(T),{value:n.two_factor_session_hours,"onUpdate:value":s[6]||(s[6]=l=>n.two_factor_session_hours=l),min:1,style:{width:"140px"}},null,8,["value"])]),e("div",ao,i(o(t)("config.twoFactorSessionHint")),1)]),e("div",no,[e("div",co,i(o(t)("config.twoFactorIssuer")),1),e("div",ro,[c(o(F),{value:n.two_factor_issuer,"onUpdate:value":s[7]||(s[7]=l=>n.two_factor_issuer=l),style:{width:"240px"}},null,8,["value"])])])])]),e("div",uo,[e("div",vo,"ðŸ“‹ "+i(o(t)("config.groupLog")),1),e("div",fo,[e("div",_o,[e("div",go,i(o(t)("config.logDir")),1),e("div",po,[c(o(F),{value:n.log_dir,"onUpdate:value":s[8]||(s[8]=l=>n.log_dir=l),placeholder:o(t)("config.logDirPlaceholder"),style:{width:"240px"}},null,8,["value","placeholder"])])]),e("div",mo,[e("div",ho,i(o(t)("config.showLogLevel")),1),e("div",wo,[c(o(q),{value:n.show_log_level,"onUpdate:value":s[9]||(s[9]=l=>n.show_log_level=l),options:j.value,style:{width:"140px"}},null,8,["value","options"])])]),e("div",bo,[e("div",yo,i(o(t)("config.saveLogLevel")),1),e("div",ko,[c(o(q),{value:n.save_log_level,"onUpdate:value":s[10]||(s[10]=l=>n.save_log_level=l),options:j.value,style:{width:"140px"}},null,8,["value","options"])])])])]),e("div",xo,[e("div",Co,[s[16]||(s[16]=e("div",{class:"info-icon"},"ðŸ–¥",-1)),e("div",Io,[e("div",Do,i(o(t)("backend.title")),1),e("div",No,[v(i(o(t)("config.backendManagementHint"))+" ",1),c(r,{to:"/backend",class:"info-link"},{default:u(()=>[v(i(o(t)("nav.backend")),1)]),_:1}),v(" "+i(o(t)("config.backendManagementHint2")),1)])])])])]),e("div",Uo,[e("div",Fo,"ðŸ’» "+i(o(t)("config.cliTitle")),1),e("div",Lo,i(o(t)("config.cliDesc")),1),e("div",{class:"terminal",ref_key:"terminalRef",ref:K},[e("div",Mo,[C.value.length===0?(D(),I("div",So,i(o(t)("config.cliWelcome")),1)):W("",!0),(D(!0),I(re,null,de(C.value,(l,S)=>(D(),I("div",{key:S,class:"terminal-entry"},[e("div",Eo,[s[17]||(s[17]=e("span",{class:"terminal-prompt"},"â¯",-1)),e("span",null,i(l.command),1)]),l.output?(D(),I("pre",{key:0,class:we(["terminal-result",{"terminal-error":l.isError}])},i(l.output),3)):W("",!0)]))),128)),e("div",{ref_key:"terminalBottom",ref:H},null,512)]),e("div",Ro,[s[18]||(s[18]=e("span",{class:"terminal-prompt"},"â¯",-1)),ue(e("input",{ref_key:"cliInputRef",ref:P,"onUpdate:modelValue":s[11]||(s[11]=l=>_.value=l),class:"terminal-input",placeholder:o(t)("config.cliInputPlaceholder"),disabled:x.value,onKeydown:Q,autocomplete:"off",spellcheck:"false"},null,40,To),[[ve,_.value]]),c(o(g),{size:"small",loading:x.value,onClick:V,style:{"flex-shrink":"0"}},{default:u(()=>[v(i(o(t)("config.cliRun")),1)]),_:1},8,["loading"]),c(o(g),{size:"small",quaternary:"",onClick:oe,style:{"flex-shrink":"0"}},{default:u(()=>[v(i(o(t)("config.cliClear")),1)]),_:1})])],512)]),e("div",Ao,[e("div",zo,"ðŸ“¦ "+i(o(t)("config.migrationTitle")),1),e("div",Ho,i(o(t)("config.migrationDesc")),1),e("div",Po,[c(o(g),{onClick:te,loading:b.value},{default:u(()=>[v(i(o(t)("config.exportMigration")),1)]),_:1},8,["loading"]),c(o(g),{onClick:se},{default:u(()=>[v(i(o(t)("config.importMigration")),1)]),_:1})]),e("input",{ref_key:"migrationFileInput",ref:z,type:"file",accept:".zip,application/zip",style:{display:"none"},onChange:le},null,544)]),e("div",jo,[e("div",Bo,"âš ï¸ "+i(o(t)("config.dangerZone")),1),e("div",Oo,i(o(t)("config.dangerZoneDesc")),1),c(o(g),{type:"error",ghost:"",onClick:s[12]||(s[12]=l=>y.value=!0)},{default:u(()=>[v(i(o(t)("config.restartServer")),1)]),_:1})]),c(o(fe),{show:y.value,"onUpdate:show":s[15]||(s[15]=l=>y.value=l),preset:"card",title:o(t)("config.restartConfirm"),style:{width:"420px"}},{footer:u(()=>[e("div",Wo,[c(o(g),{onClick:s[14]||(s[14]=l=>y.value=!1)},{default:u(()=>[v(i(o(t)("common.cancel")),1)]),_:1}),c(o(g),{type:"error",loading:M.value,onClick:G},{default:u(()=>[v(i(o(t)("common.confirm")),1)]),_:1},8,["loading"])])]),default:u(()=>[e("div",Vo,[s[19]||(s[19]=e("div",{class:"restart-warning-icon"},"âš ï¸",-1)),e("div",null,i(o(t)("config.restartWarning")),1)]),c(o(ye),{label:o(t)("auth.totpTitle"),style:{"margin-top":"16px"}},{default:u(()=>[c(o(F),{value:k.value,"onUpdate:value":s[13]||(s[13]=l=>k.value=l),placeholder:o(t)("auth.totpPlaceholder"),maxlength:"6"},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["show","title"])])}}}),it=ke($o,[["__scopeId","data-v-280e9d14"]]);export{it as default};
