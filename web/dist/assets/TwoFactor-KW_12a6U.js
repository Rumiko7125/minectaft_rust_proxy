import{d as S,u as D,o as M,c as F,e as l,t as d,g as s,f as c,w as v,B as g,l as L,ag as V,r as n,aA as y,i as N,j as R,n as I,C as b}from"./index-DQgClpag.js";import{b as P}from"./browser-JP79f-a9.js";import{u as A}from"./useTimezone-tDSj6fKI.js";import{u as K,N as j}from"./use-message-DfHQKw6A.js";import{N as E,a as G}from"./DataTable-BmjeHeaD.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-BT2YCJ3w.js";import"./Dropdown-BYzVsjoG.js";import"./get-slot-Bk_rJcZu.js";import"./Select-Dy_GmTdc.js";import"./Tag-B2_cy-hE.js";import"./Checkmark-BOYRWfKy.js";const J={class:"page-container"},O={class:"page-header"},W={class:"page-title"},X={class:"page-subtitle"},Y={class:"toolbar"},Z={class:"pagination"},$={class:"qr-container"},ee=["src"],ae={class:"secret-text"},te=S({__name:"TwoFactor",setup(oe){const{t}=D(),{formatRelativeTime:T}=A(),w=K(),p=n(!1),k=n([]),m=n(""),f=n(1),u=n(20),x=n(0);function U(e){u.value=e,i()}const h=n(!1),C=n(""),_=n(""),Q=[{title:()=>t("auth.username"),key:"username"},{title:()=>t("account.bound"),key:"bound",render:e=>e.bound?t("common.enabled"):t("common.disabled")},{title:()=>t("table.boundTime"),key:"created_at",render:e=>T(e.created_at)},{title:()=>t("common.action"),key:"action",width:200,render:e=>b("div",{style:"display: flex; gap: 8px;"},[b(g,{size:"small",onClick:()=>q(e)},{default:()=>t("twoFactor.viewQR")}),b(g,{size:"small",type:"error",onClick:()=>B(e)},{default:()=>t("twoFactor.unbind")})])}];async function q(e){var a,o;try{const r=await y.getQR(e.username);C.value=r.secret,_.value=await P.toDataURL(r.qr_data_url,{width:200,margin:2}),h.value=!0}catch(r){w.error(((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to get QR code")}}async function B(e){var a,o;try{await y.unbind(e.username),w.success(t("twoFactor.unbindSuccess")),i()}catch(r){w.error(((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"Unbind failed")}}async function i(){p.value=!0;try{const e=await y.list({limit:u.value,offset:(f.value-1)*u.value});let a=e.users||[];if(m.value){const o=m.value.toLowerCase();a=a.filter(r=>{var z;return(z=r.username)==null?void 0:z.toLowerCase().includes(o)})}k.value=a,x.value=e.total||0}catch(e){console.error(e)}finally{p.value=!1}}return M(i),(e,a)=>(N(),F("div",J,[l("div",O,[l("div",null,[l("h1",W,d(s(t)("twoFactor.title")),1),l("p",X,d(s(t)("twoFactor.desc")),1)]),c(s(g),{size:"small",onClick:i,loading:p.value},{icon:v(()=>[...a[3]||(a[3]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("polyline",{points:"23 4 23 10 17 10"}),l("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])]),default:v(()=>[R(" "+d(s(t)("common.refresh")),1)]),_:1},8,["loading"])]),l("div",Y,[c(s(j),{value:m.value,"onUpdate:value":a[0]||(a[0]=o=>m.value=o),placeholder:s(t)("twoFactor.searchPlaceholder"),clearable:"",style:{width:"220px"},onKeyup:L(i,["enter"])},null,8,["value","placeholder"]),c(s(g),{onClick:i,size:"small"},{default:v(()=>[R(d(s(t)("common.search")),1)]),_:1})]),c(s(E),{columns:Q,data:k.value,loading:p.value,bordered:!1,size:"small"},null,8,["data","loading"]),l("div",Z,[c(s(G),{page:f.value,"onUpdate:page":[a[1]||(a[1]=o=>f.value=o),i],"page-count":Math.ceil(x.value/u.value),"page-size":u.value,"onUpdate:pageSize":U},null,8,["page","page-count","page-size"])]),c(s(V),{show:h.value,"onUpdate:show":a[2]||(a[2]=o=>h.value=o),preset:"card",title:s(t)("twoFactor.viewQR"),style:{width:"350px"}},{default:v(()=>[l("div",$,[_.value?(N(),F("img",{key:0,src:_.value,alt:"QR Code",class:"qr-image"},null,8,ee)):I("",!0),l("p",ae,d(C.value),1)])]),_:1},8,["show","title"])]))}}),we=H(te,[["__scopeId","data-v-00934de7"]]);export{we as default};
