import{d as Q,u as X,o as Y,c as Z,e as i,t as r,g as e,f as o,w as n,B as d,ag as P,r as u,ah as f,i as ee,j as p,$ as ae,l as te,C as T}from"./index-DQgClpag.js";import{u as le}from"./useTimezone-tDSj6fKI.js";import{u as se,N as z}from"./use-message-DfHQKw6A.js";import{N as oe,a as E}from"./Tabs-c5IO-Gt9.js";import{N as R,a as V}from"./DataTable-BmjeHeaD.js";import{N as S}from"./FormItem-8Lqb3O-i.js";import{N as ne}from"./Form-CpuxP8S5.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-BT2YCJ3w.js";import"./Add-C00RkFDM.js";import"./Dropdown-BYzVsjoG.js";import"./get-slot-Bk_rJcZu.js";import"./Select-Dy_GmTdc.js";import"./Tag-B2_cy-hE.js";import"./Checkmark-BOYRWfKy.js";const ue={class:"page-container"},re={class:"page-header"},de={class:"page-title"},ce={class:"page-subtitle"},me={class:"tab-toolbar"},pe={style:{display:"flex",gap:"8px"}},ve={class:"pagination-row"},fe={class:"tab-toolbar"},ge={class:"pagination-row"},he={style:{display:"flex","justify-content":"flex-end",gap:"8px"}},be={style:{color:"#8b949e","margin-bottom":"12px","font-size":"13px"}},ye={style:{display:"flex","justify-content":"flex-end",gap:"8px"}},we={style:{display:"flex","justify-content":"flex-end",gap:"8px"}},ke=Q({__name:"Access",setup(xe){const{t}=X(),{formatRelativeTime:F}=le(),c=se(),h=u(!1),v=u(!1),A=u("whitelist"),I=u([]),$=u([]),g=u(!1),U=u(1),b=u(20),M=u(0),W=u(1),y=u(20),D=u(0),w=u(!1),k=u(""),x=u(!1),B=u(""),_=u(!1),C=u(""),N=u(""),K=[{title:()=>t("table.username"),key:"username",width:200},{title:()=>t("table.addedAt"),key:"added_at",render:l=>F(l.added_at)},{title:()=>t("common.action"),key:"action",width:120,render:l=>T(d,{size:"small",type:"error",ghost:!0,onClick:()=>G(l)},{default:()=>t("common.delete")})}],H=[{title:()=>t("table.username"),key:"username",width:160},{title:()=>t("table.reason"),key:"reason",render:l=>l.reason||T("span",{style:"color: #8b949e"},"-")},{title:()=>t("table.addedAt"),key:"added_at",width:180,render:l=>F(l.added_at)},{title:()=>t("common.action"),key:"action",width:120,render:l=>T(d,{size:"small",type:"success",ghost:!0,onClick:()=>O(l)},{default:()=>t("access.removeFromBlacklist")})}];async function L(){const l=!g.value;try{await f.toggleWhitelist(l),g.value=l,c.success(t(l?"access.whitelistEnabled":"access.whitelistDisabled"))}catch(a){c.error(a.message||t("common.operationFailed"))}}async function j(){if(k.value){v.value=!0;try{await f.addWhitelist(k.value),c.success(t("common.addSuccess")),w.value=!1,k.value="",m()}catch(l){c.error(l.message||t("common.operationFailed"))}finally{v.value=!1}}}async function q(){const l=B.value.split(`
`).map(a=>a.trim()).filter(Boolean);if(l.length){v.value=!0;try{for(const a of l)await f.addWhitelist(a);c.success(t("common.addSuccess")),x.value=!1,B.value="",m()}catch(a){c.error(a.message||t("common.operationFailed"))}finally{v.value=!1}}}async function G(l){try{await f.removeWhitelist(l.username),c.success(t("common.deleteSuccess")),m()}catch(a){c.error(a.message||t("common.operationFailed"))}}async function J(){if(C.value){v.value=!0;try{await f.addBlacklist(C.value,N.value||void 0),c.success(t("common.addSuccess")),_.value=!1,C.value="",N.value="",m()}catch(l){c.error(l.message||t("common.operationFailed"))}finally{v.value=!1}}}async function O(l){try{await f.removeBlacklist(l.username),c.success(t("common.deleteSuccess")),m()}catch(a){c.error(a.message||t("common.operationFailed"))}}async function m(){h.value=!0;try{const[l,a]=await Promise.all([f.getWhitelist({limit:b.value,offset:(U.value-1)*b.value}),f.getBlacklist({limit:y.value,offset:(W.value-1)*y.value})]);I.value=l.list||[],$.value=a.list||[],M.value=l.total||0,D.value=a.total||0,l.whitelist_enabled!==void 0&&(g.value=l.whitelist_enabled)}catch(l){console.error(l)}finally{h.value=!1}}return Y(m),(l,a)=>(ee(),Z("div",ue,[i("div",re,[i("div",null,[i("h1",de,r(e(t)("access.title")),1),i("p",ce,r(e(t)("access.subtitle")),1)]),o(e(d),{size:"small",onClick:m,loading:h.value},{icon:n(()=>[...a[18]||(a[18]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[i("polyline",{points:"23 4 23 10 17 10"}),i("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])]),default:n(()=>[p(" "+r(e(t)("common.refresh")),1)]),_:1},8,["loading"])]),o(e(oe),{value:A.value,"onUpdate:value":a[7]||(a[7]=s=>A.value=s),type:"line",class:"access-tabs"},{default:n(()=>[o(e(E),{name:"whitelist",tab:e(t)("access.tabWhitelist")},{default:n(()=>[i("div",me,[i("div",{class:ae(["whitelist-status",{active:g.value}])},[a[19]||(a[19]=i("span",{class:"status-dot"},null,-1)),i("span",null,r(g.value?e(t)("access.whitelistEnabled"):e(t)("access.whitelistDisabled")),1),o(e(d),{size:"small",type:g.value?"default":"primary",onClick:L},{default:n(()=>[p(r(g.value?e(t)("access.disableWhitelist"):e(t)("access.enableWhitelist")),1)]),_:1},8,["type"])],2),i("div",pe,[o(e(d),{onClick:a[0]||(a[0]=s=>x.value=!0)},{default:n(()=>[p(r(e(t)("access.batchImport")),1)]),_:1}),o(e(d),{type:"primary",onClick:a[1]||(a[1]=s=>w.value=!0)},{default:n(()=>[p(r(e(t)("common.add")),1)]),_:1})])]),o(e(R),{columns:K,data:I.value,loading:h.value,bordered:!1},null,8,["data","loading"]),i("div",ve,[o(e(V),{page:U.value,"onUpdate:page":[a[2]||(a[2]=s=>U.value=s),m],"page-count":Math.ceil(M.value/b.value),"page-size":b.value,"onUpdate:pageSize":a[3]||(a[3]=s=>{b.value=s,m()})},null,8,["page","page-count","page-size"])])]),_:1},8,["tab"]),o(e(E),{name:"blacklist",tab:e(t)("access.tabBlacklist")},{default:n(()=>[i("div",fe,[a[20]||(a[20]=i("div",null,null,-1)),o(e(d),{type:"error",onClick:a[4]||(a[4]=s=>_.value=!0)},{default:n(()=>[p(r(e(t)("access.addToBlacklist")),1)]),_:1})]),o(e(R),{columns:H,data:$.value,loading:h.value,bordered:!1},null,8,["data","loading"]),i("div",ge,[o(e(V),{page:W.value,"onUpdate:page":[a[5]||(a[5]=s=>W.value=s),m],"page-count":Math.ceil(D.value/y.value),"page-size":y.value,"onUpdate:pageSize":a[6]||(a[6]=s=>{y.value=s,m()})},null,8,["page","page-count","page-size"])])]),_:1},8,["tab"])]),_:1},8,["value"]),o(e(P),{show:w.value,"onUpdate:show":a[10]||(a[10]=s=>w.value=s),preset:"card",title:e(t)("access.addToWhitelist"),style:{width:"400px"}},{footer:n(()=>[i("div",he,[o(e(d),{onClick:a[9]||(a[9]=s=>w.value=!1)},{default:n(()=>[p(r(e(t)("common.cancel")),1)]),_:1}),o(e(d),{type:"primary",loading:v.value,onClick:j},{default:n(()=>[p(r(e(t)("common.confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[o(e(S),{label:e(t)("auth.username")},{default:n(()=>[o(e(z),{value:k.value,"onUpdate:value":a[8]||(a[8]=s=>k.value=s),placeholder:e(t)("access.usernamePlaceholder"),onKeyup:te(j,["enter"])},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["show","title"]),o(e(P),{show:x.value,"onUpdate:show":a[13]||(a[13]=s=>x.value=s),preset:"card",title:e(t)("access.batchImport"),style:{width:"500px"}},{footer:n(()=>[i("div",ye,[o(e(d),{onClick:a[12]||(a[12]=s=>x.value=!1)},{default:n(()=>[p(r(e(t)("common.cancel")),1)]),_:1}),o(e(d),{type:"primary",loading:v.value,onClick:q},{default:n(()=>[p(r(e(t)("common.confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[i("p",be,r(e(t)("access.batchImportHint")),1),o(e(z),{value:B.value,"onUpdate:value":a[11]||(a[11]=s=>B.value=s),type:"textarea",rows:6,placeholder:e(t)("access.batchImportPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["show","title"]),o(e(P),{show:_.value,"onUpdate:show":a[17]||(a[17]=s=>_.value=s),preset:"card",title:e(t)("access.addToBlacklist"),style:{width:"400px"}},{footer:n(()=>[i("div",we,[o(e(d),{onClick:a[16]||(a[16]=s=>_.value=!1)},{default:n(()=>[p(r(e(t)("common.cancel")),1)]),_:1}),o(e(d),{type:"error",loading:v.value,onClick:J},{default:n(()=>[p(r(e(t)("common.confirm")),1)]),_:1},8,["loading"])])]),default:n(()=>[o(e(ne),{"label-placement":"left","label-width":80},{default:n(()=>[o(e(S),{label:e(t)("auth.username")},{default:n(()=>[o(e(z),{value:C.value,"onUpdate:value":a[14]||(a[14]=s=>C.value=s),placeholder:e(t)("access.usernamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(S),{label:e(t)("access.banReason")},{default:n(()=>[o(e(z),{value:N.value,"onUpdate:value":a[15]||(a[15]=s=>N.value=s),type:"textarea",rows:2,placeholder:e(t)("access.banReasonPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1},8,["show","title"])]))}}),De=ie(ke,[["__scopeId","data-v-6042868b"]]);export{De as default};
