import{d as F,u as G,o as H,c as J,e as l,t as u,g as a,f as n,w as i,r,ai as y,q as Q,i as W,l as P,B as g,j as v,C as X}from"./index-DQgClpag.js";import{u as Y}from"./useTimezone-tDSj6fKI.js";import{u as Z,N as U}from"./use-message-DfHQKw6A.js";import{N as $,a as B}from"./Tabs-c5IO-Gt9.js";import{N as ee}from"./Select-Dy_GmTdc.js";import{N as E,a as K}from"./DataTable-BmjeHeaD.js";import{N as ae}from"./Tag-B2_cy-hE.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-BT2YCJ3w.js";import"./Add-C00RkFDM.js";import"./Checkmark-BOYRWfKy.js";import"./Dropdown-BYzVsjoG.js";import"./get-slot-Bk_rJcZu.js";const te={class:"page-container"},se={class:"page-header"},le={class:"page-title"},ne={class:"toolbar"},ie={class:"toolbar-left"},re={class:"toolbar-right"},ce={class:"pagination"},de={class:"toolbar"},ue={class:"toolbar-left"},me={class:"toolbar-right"},pe={class:"pagination"},ge=F({__name:"Logs",setup(ve){const{t}=G(),{formatRelativeTime:w}=Y(),b=Z(),c=r(!1),C=r("moderation"),S=r([]),N=r([]),m=Q({action:null,target:""}),k=r(1),f=r(20),T=r(0),_=r(""),x=r(1),h=r(20),L=r(0),V=[{label:"Kick",value:"kick"},{label:"Ban",value:"ban"},{label:"Pardon",value:"pardon"}],I=[{title:()=>t("common.time"),key:"timestamp",width:180,render:e=>w(e.timestamp)},{title:()=>t("common.action"),key:"action",width:80,render:e=>{const o=e.action==="kick"?"warning":e.action==="ban"?"error":"success";return X(ae,{type:o,size:"small"},{default:()=>e.action})}},{title:()=>t("table.username"),key:"target"},{title:()=>t("table.admin"),key:"operator"},{title:()=>t("table.reason"),key:"reason"}],R=[{title:()=>t("table.username"),key:"username",width:150},{title:()=>t("table.uuid"),key:"uuid",width:150},{title:()=>t("table.backend"),key:"backend_addr"},{title:()=>t("table.loginTime"),key:"login_at",width:160,render:e=>w(e.login_at)},{title:()=>t("table.logoutTime"),key:"logout_at",width:160,render:e=>w(e.logout_at)}];function j(e){f.value=e,d()}function A(e){h.value=e,p()}async function d(){c.value=!0;try{const e=await y.getModeration({action:m.action||void 0,target:m.target||void 0,limit:f.value,offset:(k.value-1)*f.value});S.value=e.logs||[],T.value=e.total||0}catch(e){console.error(e)}finally{c.value=!1}}async function p(){c.value=!0;try{const e=await y.getSessions({search:_.value||void 0,limit:h.value,offset:(x.value-1)*h.value});N.value=e.sessions||[],L.value=e.total||0}catch(e){console.error(e)}finally{c.value=!1}}async function D(){var e,o;try{const s=await y.exportModeration();M(s.csv,"moderation_logs.csv"),b.success(t("common.success"))}catch(s){b.error(((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||"Export failed")}}async function O(){var e,o;try{const s=await y.exportSessions({search:_.value||void 0});M(s.csv,"session_logs.csv"),b.success(t("common.success"))}catch(s){b.error(((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.message)||"Export failed")}}function M(e,o){const s=new Blob([e],{type:"text/csv;charset=utf-8;"}),z=document.createElement("a");z.href=URL.createObjectURL(s),z.download=o,z.click()}function q(e){e==="moderation"?d():p()}return H(()=>{d()}),(e,o)=>(W(),J("div",te,[l("div",se,[l("h1",le,u(a(t)("logs.title")),1)]),n(a($),{value:C.value,"onUpdate:value":[o[5]||(o[5]=s=>C.value=s),q],type:"line"},{default:i(()=>[n(a(B),{name:"moderation",tab:a(t)("logs.tabModeration")},{default:i(()=>[l("div",ne,[l("div",ie,[n(a(ee),{value:m.action,"onUpdate:value":o[0]||(o[0]=s=>m.action=s),options:V,placeholder:a(t)("logs.filterAction"),clearable:"",style:{width:"130px"}},null,8,["value","placeholder"]),n(a(U),{value:m.target,"onUpdate:value":o[1]||(o[1]=s=>m.target=s),placeholder:a(t)("logs.filterPlayer"),clearable:"",style:{width:"160px"},onKeyup:P(d,["enter"])},null,8,["value","placeholder"]),n(a(g),{onClick:d,size:"small"},{default:i(()=>[v(u(a(t)("common.search")),1)]),_:1})]),l("div",re,[n(a(g),{size:"small",onClick:d,loading:c.value},{icon:i(()=>[...o[6]||(o[6]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("polyline",{points:"23 4 23 10 17 10"}),l("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])]),default:i(()=>[v(" "+u(a(t)("common.refresh")),1)]),_:1},8,["loading"]),n(a(g),{size:"small",onClick:D},{default:i(()=>[v(u(a(t)("common.export")),1)]),_:1})])]),n(a(E),{columns:I,data:S.value,loading:c.value,bordered:!1,size:"small"},null,8,["data","loading"]),l("div",ce,[n(a(K),{page:k.value,"onUpdate:page":[o[2]||(o[2]=s=>k.value=s),d],"page-count":Math.ceil(T.value/f.value),"page-size":f.value,"onUpdate:pageSize":j},null,8,["page","page-count","page-size"])])]),_:1},8,["tab"]),n(a(B),{name:"session",tab:a(t)("logs.tabSession")},{default:i(()=>[l("div",de,[l("div",ue,[n(a(U),{value:_.value,"onUpdate:value":o[3]||(o[3]=s=>_.value=s),placeholder:a(t)("logs.sessionSearch"),clearable:"",style:{width:"220px"},onKeyup:P(p,["enter"])},null,8,["value","placeholder"]),n(a(g),{onClick:p,size:"small"},{default:i(()=>[v(u(a(t)("common.search")),1)]),_:1})]),l("div",me,[n(a(g),{size:"small",onClick:p,loading:c.value},{icon:i(()=>[...o[7]||(o[7]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[l("polyline",{points:"23 4 23 10 17 10"}),l("path",{d:"M20.49 15a9 9 0 1 1-2.12-9.36L23 10"})],-1)])]),default:i(()=>[v(" "+u(a(t)("common.refresh")),1)]),_:1},8,["loading"]),n(a(g),{size:"small",onClick:O},{default:i(()=>[v(u(a(t)("common.export")),1)]),_:1})])]),n(a(E),{columns:R,data:N.value,loading:c.value,bordered:!1,size:"small"},null,8,["data","loading"]),l("div",pe,[n(a(K),{page:x.value,"onUpdate:page":[o[4]||(o[4]=s=>x.value=s),p],"page-count":Math.ceil(L.value/h.value),"page-size":h.value,"onUpdate:pageSize":A},null,8,["page","page-count","page-size"])])]),_:1},8,["tab"])]),_:1},8,["value"])]))}}),Le=oe(ge,[["__scopeId","data-v-4b68c4f4"]]);export{Le as default};
